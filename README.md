# Lab 4 OS: Synchronization

## Условие задачи

**Задача:** Реализовать программу для взаимодействия процессов через общий разделяемый файл, работающий по принципу кольцевого буфера, с использованием примитивов синхронизации Windows API.

Система состоит из двух консольных процессов: **Receiver** (Потребитель) и **Sender** (Производитель).

### 1. Процесс Receiver (Основной)
Управляет созданием окружения и чтением сообщений. Выполняет следующие действия:
1.  **Инициализация:**
    *   Создает бинарный файл фиксированного размера для передачи данных.
    *   Создает объекты синхронизации: Мьютекс и Семафоры.
2.  **Запуск:** Запрашивает у пользователя количество процессов-отправителей (`Sender`) и запускает их.
3.  **Синхронизация запуска:** Ждет сигнала готовности (`SemReady`) от всех отправителей.
4.  **Работа (Цикл):**
    *   Выводит меню. По команде пользователя читает сообщение.
    *   Блокируется до появления данных в буфере (на семафоре `SemFull`).
    *   Захватывает мьютекс файла.
    *   Считывает сообщение по указателю `head` (логика FIFO).
    *   Освобождает мьютекс и увеличивает счетчик свободных мест (`SemEmpty`).

### 2. Процесс Sender (Вспомогательный)
Отвечает за генерацию данных. Выполняет следующие действия:
1.  Открывает существующие объекты синхронизации по их именам.
2.  Сигнализирует о своей готовности.
3.  **Работа (Цикл):**
    *   Считывает текст сообщения с консоли.
    *   Ждет освобождения места в буфере (блокировка на семафоре `SemEmpty`).
    *   Захватывает мьютекс файла.
    *   Записывает сообщение по указателю `tail` (кольцевой буфер).
    *   Освобождает мьютекс и сигнализирует о появлении данных (`SemFull`).

### 3. Модульное тестирование (Unit Tests)
Проект включает автоматические тесты (GoogleTest), проверяющие:
*   Корректную инициализацию заголовка файла.
*   Движение указателей чтения (`head`) и записи (`tail`).
*   Логику кольцевого переполнения (запись по кругу при достижении конца файла).

## Технический стек

*   **Язык:** C++ (Standard: C++17)
*   **ОС / API:** Windows (CreateMutex, CreateSemaphore, CreateProcess, WaitForSingleObject)
*   **Сборка:** CMake 3.14+
*   **Тесты:** GoogleTest (автоматическое скачивание через FetchContent)

## Структура проекта

```text
Project Root
├── CMakeLists.txt     # Конфигурация сборки (Receiver, Sender, UnitTests)
├── common.h           # Общая структура сообщения, заголовка и логика I/O файла
├── receiver.cpp       # Логика процесса-приемника (инициализация и чтение)
├── sender.cpp         # Логика процесса-отправителя (запись данных)
└── tests.cpp          # Unit-тесты для проверки логики буфера без IPC
